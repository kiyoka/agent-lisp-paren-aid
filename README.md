# agent-lisp-paren-aid  
*日本語版は [README.ja.md](README.ja.md) をご覧ください。*

## Project Overview

`agent-lisp-paren-aid` is a tool that automatically checks parenthesis matching in Lisp code generated by LLM (Large Language Model) based **coding agents**. While primarily designed for Emacs Lisp, it can also be used with other Lisp dialects that use simple S-expressions.

Although recent LLMs have become increasingly sophisticated, in languages like Lisp where parenthesis matching is critical, cases of **missing or excess closing parentheses** still occur. By incorporating this tool into your workflow, you can immediately verify agent-generated source code and pinpoint locations that need correction.

LLM-generated Lisp code often has correct indentation despite having **missing or excess closing parentheses**. Therefore, this tool uses Emacs to re-indent the code and reports the locations where indentation breaks as the problematic line numbers.

## Features

* When there are **too many** parentheses → Reports the exact line number where excess opening parentheses exist.
* When there are **too few** parentheses → Reports the exact line number where closing parentheses are missing.

## Installation

Download the cross-platform binary for your OS from the GitHub release page and place it in a directory in your PATH.

Available binaries:
- `agent-lisp-paren-aid-linux` (Linux x86_64)
- `agent-lisp-paren-aid-darwin-amd64` (macOS Intel)
- `agent-lisp-paren-aid-darwin-arm64` (macOS Apple Silicon)

Rename the binary to `agent-lisp-paren-aid` for easier use.

## Usage

```bash
# Basic usage
$ agent-lisp-paren-aid <file.el>

# Display version
$ agent-lisp-paren-aid --version
```

### Output Examples

| Status | Output |
|--------|--------|
| Normal | `ok` |
| Too many parentheses | `Error: line 8: There are extra 1 closing parentheses.` |
| Too few parentheses | `Error: line 9: Missing 1 closing parentheses.` |

> **Note**: Even when multiple mismatches exist, only the first one found from the beginning of the file will be reported.

## Integration into Coding Agent Workflows

Adding the following text to AGENTS.md/GEMINI.md/CLAUDE.md will encourage agents to actively use this tool.

```
## Editing Process
- After editing <your Lisp program name>, always run agent-lisp-paren-aid to check if the closing parentheses match correctly.

If parentheses are mismatched, it will tell you which line number needs to be fixed.

agent-lisp-paren-aid <your Lisp program name>

If a mismatch is detected, do not perform any other editing tasks. Instead, first make corrections only to add parentheses at the line number indicated,
then run agent-lisp-paren-aid again.
Since LLMs are not good at counting Lisp parentheses, always use this tool instead of counting or thinking about it yourself.
```

## Prerequisites

* **Emacs** (Used for indentation analysis when parentheses are missing)
* **Go 1.21+** (Only required for building from source, not needed for running the binary)

## Development

```bash
$ make test   # Run unit tests with Go
# or
$ go test -v
```

For build instructions, see [HOW_TO_BUILD.md](HOW_TO_BUILD.md)

## License

MIT License